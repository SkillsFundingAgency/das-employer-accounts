@using System.Linq
@using SFA.DAS.EmployerAccounts.Web.Extensions
@model OrchestratorResponse<ICollection<OrganisationAgreementViewModel>>

@{
    Layout = "~/Views/Shared/_Layout_CDN.cshtml";
    ViewBag.PageID = "organisations-agreements-details";
    ViewBag.Title = "ViewAllAgreements";
    ViewBag.Section = "organisations";
    ViewBag.ZenDeskLabel = "eas-your-esfa-agreement";
    ViewBag.GaData.Vpv = "/accounts/agreements/view-your-agreement/agreement-details";
}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <h1 class="govuk-heading-xl">Your agreements with the Education and Skills Funding Agency (<abbr>ESFA</abbr>)</h1>
        <h3 class="govuk-heading-l">Agreement ID: @ViewBag.AgreementId</h3>
    </div>
</div>

<hr class="govuk-!-margin-top-6 govuk-!-margin-bottom-6">

@Html.Partial("_AwaitingAcceptance", Model.Data.First(), new ViewDataDictionary { { "Inset", Model.Data.First().Template.InsetText(Model.Data) } })

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        <h3 class="govuk-heading-m">Accepted agreements</h3>
        @if (Model.Data.Any(agreement => agreement.SignedDate != null))
        {
            <div class="govuk-accordion" data-module="govuk-accordion" id="accordion-default">
                @foreach (var agreement in Model.Data.Where(agreement => agreement.SignedDate != null))
                {
                    @Html.Partial("_AcceptedAgreement", agreement, new ViewDataDictionary{{"Inset", agreement.Template.InsetText(Model.Data) } })
                }
            </div>
        }
        else
        {
            <h3 class="govuk-heading-s govuk-!-margin-bottom-9">You have no accepted agreements</h3>
        }
    </div>
</div>

@section breadcrumb {
    <div class="govuk-breadcrumbs">
        <ol class="govuk-breadcrumbs__list" role="navigation">
            <li class="govuk-breadcrumbs__list-item">
                <a class="govuk-breadcrumbs__link" href="@Url.Action("Index", "EmployerTeam")">Home</a>
            </li>
            <li class="govuk-breadcrumbs__list-item">
                <a class="govuk-breadcrumbs__link" href="@Url.Action("Index", "EmployerAgreement")">Your organisations and agreements</a>
            </li>
            <li class="govuk-breadcrumbs__list-item" aria-current="page">@ViewBag.BreadCrumbsTrail</li>
        </ol>
    </div>
}
